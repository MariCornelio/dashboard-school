<p-card class="card">
  <p-toast />
  <app-loader-dialog [visible]="loadingDeleteTeacher" [message]="'Eliminando profesor'" />
  <p-table #tableTeachers [value]="teachers" dataKey="id" [rows]="10" [rowsPerPageOptions]="[10, 25, 50]"
    (onPage)="onPage($event)" [loading]="loading" [showLoader]="false" [paginator]="paginator"
    [globalFilterFields]="['name', 'dni', 'phone', 'specialty', 'active']" [tableStyle]="{ 'min-width': '75rem' }"
    class="overflow-y-hidden">
    <ng-template #caption>
      <div class="flex gap-2 items-center justify-center">
        <p-button label="Agregar Profesor" icon="pi pi-plus" (onClick)="openNewTeacher()" />
        <p-iconfield iconPosition="left" class="ml-auto">
          <p-inputicon>
            <i class="pi pi-search"></i>
          </p-inputicon>
          <input pInputText type="text" #InputFilterGlobal
            (input)="tableTeachers.filterGlobal(InputFilterGlobal.value, 'contains')"
            placeholder="Escribe para buscar..." />
        </p-iconfield>
      </div>
    </ng-template>
    <ng-template #header>
      <tr>
        <th style="min-width:18rem">Nombre</th>
        <th style="min-width:12rem">DNI</th>
        <th style="min-width:12rem">Teléfono</th>
        <th style="min-width:12rem">Especialidad</th>
        <th style="min-width:12rem">Cursos</th>
        <th style="min-width:8rem;text-align:center">Activo</th>
        <th style="min-width:12rem;text-align:center">Acciones</th>
      </tr>
      <tr>
        <th>
          <p-columnFilter type="text" field="name" placeholder="Buscar por nombre" ariaLabel="Filtrar por nombre"
            filterOn="input" matchMode="contains" [showMenu]="false"></p-columnFilter>
        </th>
        <th>
          <p-columnFilter type="text" field="dni" placeholder="Buscar por DNI" ariaLabel="Filtrar por DNI"
            filterOn="input" matchMode="contains" [showMenu]="false"></p-columnFilter>
        </th>
        <th>
          <p-columnFilter type="text" field="phone" placeholder="Buscar por teléfono" ariaLabel="Filtrar por teléfono"
            filterOn="input" matchMode="contains" [showMenu]="false"></p-columnFilter>
        </th>
        <th>
          <p-columnFilter type="text" field="speciality" placeholder="Buscar por especialidad"
            ariaLabel="Filtrar por especialidad" filterOn="input" matchMode="contains"
            [showMenu]="false"></p-columnFilter>
        </th>
        <th></th>
        <th style="text-align: center;">
          <p-columnFilter type="boolean" field="active" display="menu"></p-columnFilter>
        </th>
        <th></th>
      </tr>
    </ng-template>

    <!-- Cuando loading = true -->
    <ng-template #loadingbody>
      <tr *ngFor="let _ of skeletonArray">
        <td><p-skeleton width="100%"></p-skeleton></td>
        <td><p-skeleton width="100%"></p-skeleton></td>
        <td><p-skeleton width="100%"></p-skeleton></td>
        <td><p-skeleton width="100%"></p-skeleton></td>
        <td><p-skeleton width="100%"></p-skeleton></td>
        <td>
          <div class="flex justify-center">
            <p-skeleton shape="circle" size="2rem"></p-skeleton>
          </div>
        </td>
        <td>
          <div class="flex justify-center">
            <p-skeleton shape="circle" size="2rem"></p-skeleton>
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Cuando loading = false -->
    <ng-template #body let-teacher>
      <tr>
        <td>
          <div class="flex items-center gap-4">
            <p-avatar [image]="teacher.image || 'new-user.png'" shape="circle"></p-avatar>
            <div class="flex flex-col">
              <p class="font-medium">{{teacher.name}}</p>
              <p class="text-gray-500">{{teacher.email}}</p>
            </div>
          </div>
        </td>
        <td>{{ teacher.dni }}</td>
        <td>{{ teacher.phone }}</td>
        <td>{{ teacher.specialty }}</td>
        <td>
          @if (loadingCoursesMap[teacher.id]) {
          <p-skeleton width="100%"></p-skeleton>
          }@else {
          <ol>
            @for (course of teachersCoursesMap[teacher.id]; track course.id) {
            <li>{{course.name}}</li>
            }
          </ol>
          }
        </td>
        <td style="text-align:center;">
          <i class="pi" [ngClass]="{
                 'text-green-500 pi-check-circle': teacher.active,
                 'text-red-500 pi-times-circle': !teacher.active
               }">
          </i>
        </td>
        <td>
          <div class="flex justify-center">
            <p-button [icon]="loadingAssignmentsTeacher[teacher.id]?'pi pi-spin pi-spinner':'pi pi-pencil'" class="mr-2"
              [rounded]="true" [outlined]="true" (onClick)="openEditTeacher(teacher, teachersCoursesMap[teacher.id])" />
            <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true"
              (onClick)="confirmDelete.show()" />
          </div>
        </td>
      </tr>
      <!-- Modal para eliminar usuario -->
      <app-delete-dialog #confirmDelete [header]="'Eliminar Profesor(a)'"
        [message]="`Deseas eliminar a ${teacher.name} de forma permanente?`" (onAccept)="deleteTeacher(teacher)" />
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="7">No se encontró profesores.</td>
      </tr>
    </ng-template>
  </p-table>
</p-card>
<app-modal-teacher />